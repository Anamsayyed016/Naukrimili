# ONE-LINER FIX FOR HOSTINGER TERMINAL
# Copy and paste this entire command into your Hostinger terminal:

cd /var/www/jobportal && pm2 stop all && pm2 delete all && pkill -f node && lsof -ti:3000 | xargs kill -9 2>/dev/null || true && systemctl restart nginx && npm ci --only=production --legacy-peer-deps && npx prisma generate && NODE_OPTIONS="--max-old-space-size=4096" NEXT_TELEMETRY_DISABLED=1 npx next build --no-lint && pm2 start ecosystem.config.cjs --env production && sleep 5 && pm2 status && curl http://localhost:3000/api/health

# ALTERNATIVE: Step-by-step commands (if one-liner doesn't work):

# Step 1: Navigate and stop processes
cd /var/www/jobportal
pm2 stop all
pm2 delete all
pkill -f node

# Step 2: Kill port 3000 and restart nginx
lsof -ti:3000 | xargs kill -9 2>/dev/null || true
systemctl restart nginx

# Step 3: Install dependencies and build
npm ci --only=production --legacy-peer-deps
npx prisma generate
NODE_OPTIONS="--max-old-space-size=4096" npx next build --no-lint

# Step 4: Start PM2
pm2 start ecosystem.config.cjs --env production

# Step 5: Check status
pm2 status
curl http://localhost:3000/api/health

# If you get errors, check logs:
pm2 logs jobportal
