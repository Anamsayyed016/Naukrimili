═══════════════════════════════════════════════════════════════════
🚀 NAUKRIMILI - WELCOME EMAIL FIX DEPLOYMENT COMMANDS
═══════════════════════════════════════════════════════════════════

📋 COPY AND PASTE THESE COMMANDS ONE BY ONE ON YOUR SERVER:

─────────────────────────────────────────────────────────────────
STEP 1: Navigate to project directory
─────────────────────────────────────────────────────────────────
cd /var/www/naukrimili

─────────────────────────────────────────────────────────────────
STEP 2: Pull latest code
─────────────────────────────────────────────────────────────────
git stash
git pull origin main

─────────────────────────────────────────────────────────────────
STEP 3: Install dependencies (if any)
─────────────────────────────────────────────────────────────────
npm install

─────────────────────────────────────────────────────────────────
STEP 4: Build the application
─────────────────────────────────────────────────────────────────
npm run build

─────────────────────────────────────────────────────────────────
STEP 5: Restart PM2 (delete and start to reload environment)
─────────────────────────────────────────────────────────────────
pm2 delete naukrimili
pm2 start ecosystem.config.cjs --env production

─────────────────────────────────────────────────────────────────
STEP 6: Check PM2 status
─────────────────────────────────────────────────────────────────
pm2 status

─────────────────────────────────────────────────────────────────
STEP 7: Verify Gmail environment variables
─────────────────────────────────────────────────────────────────
pm2 env 0 | grep -E "(GMAIL|GOOGLE_CLIENT|NEXTAUTH)" | head -10

─────────────────────────────────────────────────────────────────
STEP 8: Monitor logs
─────────────────────────────────────────────────────────────────
pm2 logs naukrimili --lines 50

═══════════════════════════════════════════════════════════════════
🧪 HOW TO TEST THE WELCOME EMAIL:
═══════════════════════════════════════════════════════════════════

1. Open https://naukrimili.com in an INCOGNITO/PRIVATE window
2. Click "Sign Up" or "Login"
3. Click "Continue with Google"
4. Complete the Google OAuth login
5. Check your Gmail inbox for the welcome email
   (Should arrive within 10-30 seconds)

═══════════════════════════════════════════════════════════════════
📊 USEFUL MONITORING COMMANDS:
═══════════════════════════════════════════════════════════════════

# Watch logs in real-time
pm2 logs naukrimili --lines 50

# Check only Gmail-related logs
pm2 logs naukrimili --lines 100 | grep -i "gmail\|email\|welcome"

# Check environment variables
pm2 env 0 | grep GMAIL

# Restart if needed
pm2 restart naukrimili

# Check PM2 status
pm2 status

═══════════════════════════════════════════════════════════════════
🔍 WHAT TO LOOK FOR IN LOGS:
═══════════════════════════════════════════════════════════════════

SUCCESS MESSAGES:
✅ "Gmail OAuth2 service initialized successfully"
✅ "Welcome email and notification sent for new Google OAuth user"
✅ "Email sent successfully via Gmail API"
✅ "Google OAuth provider configured successfully"

ERROR MESSAGES (if any):
❌ "Failed to send welcome email/notification"
❌ "Gmail OAuth2 service initialization failed"
❌ "invalid_client" or "Unauthorized"

═══════════════════════════════════════════════════════════════════
🐛 TROUBLESHOOTING:
═══════════════════════════════════════════════════════════════════

If emails don't send:

1. Check if Gmail variables are loaded:
   pm2 env 0 | grep GMAIL

2. Verify refresh token in .env:
   cat .env | grep GMAIL_API_REFRESH_TOKEN

3. Check Google OAuth redirect URI in Google Console:
   Must include: https://naukrimili.com/api/auth/callback/google

4. Clear user database to test fresh signup:
   (Only if testing with same account)

5. Monitor logs during signup:
   pm2 logs naukrimili -f

═══════════════════════════════════════════════════════════════════
📝 WHAT WAS FIXED:
═══════════════════════════════════════════════════════════════════

✅ Updated lib/nextauth-config.ts to call sendWelcomeEmail()
   when new Google OAuth users are created

✅ Previously: Only database notification was created
✅ Now: Both email and database notification are sent

✅ The welcome email uses Gmail OAuth2 (naukrimili@naukrimili.com)
   with professional HTML template

═══════════════════════════════════════════════════════════════════
🎯 EXPECTED RESULT:
═══════════════════════════════════════════════════════════════════

When a new user signs up with Google OAuth:

1. User completes Google login
2. NextAuth creates user account in database
3. sendWelcomeEmail() is automatically triggered
4. Gmail OAuth2 service initializes
5. Welcome email is sent from naukrimili@naukrimili.com
6. User receives professional HTML welcome email
7. Database notification is also created
8. All events are logged in PM2 logs

Time: Entire process takes 2-5 seconds
Email delivery: 10-30 seconds after signup

═══════════════════════════════════════════════════════════════════
✅ DEPLOYMENT COMPLETE - READY TO TEST!
═══════════════════════════════════════════════════════════════════

